######################################
############# Order Book #############

cd sw
ignite scaffold chain ob
cd ob



# ======== CREATE MODULE DEX ========
ignite chain serve
ignite scaffold module dex --dep auth --dep bank
ignite chain serve -r



# ======== CREATE MAP STORAGE ========
ignite scaffold map market baseDenom quoteDenom tickSize lotSize status --module dex 

ignite scaffold map order marketId orderType side price quantity remaining createdAt createdHeight status --module dex

ignite scaffold map orderbook marketId side price orderId --no-message --module dex

ignite chain serve -r



# ============= CUSTOMER =============
ignite scaffold message registerPairs baseDenom:string quoteDenom:string tickSize:string lotSize:string --module dex --response id:string
ignite scaffold message placeOrder marketId:string side:string price:string quantity:string --module dex --response orderId:string
ignite scaffold message cleanOrders limit:uint --module dex

ignite chain serve -r



# ======== TEST - MSG SERVICE ========
ignite chain serve --reset-once

obd q dex list-market
obd q dex list-order
obd q dex list-orderbook

obd tx dex register-pairs ATOM USDT 0.01 1 --from alice --chain-id ob -y

obd q dex list-market

obd tx dex place-order ATOM-USDT BUY 10 50 --from alice --chain-id ob -y

obd q dex list-order
obd q dex list-orderbook



# ===== TEST - SORTED ORDERBOOK =====
ignite chain serve --reset-once

obd q dex list-market
obd q dex list-order
obd q dex list-orderbook

obd tx dex register-pairs ATOM USDT 0.01 1 --from alice --chain-id ob -y

obd q dex list-market

obd tx dex place-order ATOM-USDT BUY 12 100 --from alice -y
obd tx dex place-order ATOM-USDT BUY 10 50 --from alice -y
obd tx dex place-order ATOM-USDT BUY 15 80 --from alice -y

obd q dex list-order
obd q dex list-orderbook



# ==== TEST - MATCHING ORDERBOOK ====
ignite chain serve --reset-once

obd q dex list-market
obd q dex list-order
obd q dex list-orderbook

obd tx dex register-pairs ATOM USDT 0.01 1 --from alice --chain-id ob -y

obd q dex list-market

obd tx dex place-order ATOM-USDT BUY 10 100 --from alice --chain-id ob -y

obd q dex list-order
obd q dex list-orderbook

obd tx dex place-order ATOM-USDT SELL 10 40 --from bob --chain-id ob -y

obd q dex list-order
obd q dex list-orderbook



# == TEST - LIMIT/MARKET ORDERBOOK ==
ignite chain serve --reset-once

obd q dex list-market
obd q dex list-order
obd q dex list-orderbook

obd tx dex register-pairs ATOM USDT 0.01 1 --from alice --chain-id ob -y

obd q dex list-market

obd tx dex place-order ATOM-USDT BUY 10 100 --from alice -y

obd q dex list-order
obd q dex list-orderbook

obd tx dex place-order ATOM-USDT SELL 0 50 --from bob -y

obd q dex list-order
obd q dex list-orderbook

obd tx dex place-order ATOM-USDT SELL 0 50 --from bob -y

obd q dex list-order
obd q dex list-orderbook